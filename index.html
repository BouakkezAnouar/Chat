<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Real-time Super Chat!</title>
    <style>
        #zone_chat strong {
            color: white;
            background-color: black;
            padding: 2px;
        }
    </style>
</head>

<body>
    <h1>Real-time Super Chat!</h1>

    <form id="chat_form">
        <input type="text" name="message" id="message" placeholder="Your message..." size="50" autofocus />
        <input type="submit" id="send_message" value="Send" />
    </form>

    <section id="chat_zone">

    </section>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io.connect("http://localhost:8080");
        let username;
        while (!username || username.length < 3)
            username = prompt("what's your name (must be at least 3 caracters)");

        socket.emit("join", { name: username, time: formatDate() });



        socket.on("join", ({ name, time }) => {
            userJoin(name, time);
        })

        userJoin = (name, time) => {
            console.log(time, name);
            let oldMessage = document.getElementById("chat_zone");
            let message = `<div> ${time} - ${name} join the chat ! </div>`;
            oldMessage.innerHTML = message + oldMessage.innerHTML;
        }

        function formatDate() {
            date = new Date();
            let monthNames = [
                "January", "February", "March",
                "April", "May", "June", "July",
                "August", "September", "October",
                "November", "December"
            ];
            let seconds = date.getSeconds().toString().padStart(2, '0');
            let minutes = date.getMinutes().toString().padStart(2, '0');
            let hours = date.getHours().toString().padStart(2, '0');
            let day = date.getDate();
            let monthIndex = date.getMonth();
            let year = date.getFullYear();

            return day + ' ' + monthNames[monthIndex] + ' ' + year + ' ' + hours + ':' + minutes + ':' + seconds;
        }
    </script>
</body>

</html>